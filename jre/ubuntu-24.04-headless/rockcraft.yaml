name: jre
version: 11-edge
base: bare
build-base: ubuntu@24.04
platforms:
  amd64:
  arm64:
    build-on: [amd64]

run-user: _daemon_

environment:
  JAVA_HOME: /usr/lib/jvm/java-11-openjdk-${CRAFT_ARCH_BUILD_FOR}

summary: OpenJDK 11 headless runtime environment
description: |
  This rock provides OpenJDK 11 runtime environment including the following modules:
  - java.base
  - java.instrument
  - java.logging
  - java.management
  - java.management.rmi
  - java.naming
  - java.net.http
  - java.prefs
  - java.rmi
  - java.scripting
  - java.se
  - java.security.jgss
  - java.security.sasl
  - java.smartcardio
  - java.sql
  - java.sql.rowset
  - java.transaction.xa
  - java.xml
  - java.xml.crypto
  - jdk.aot
  - jdk.attach
  - jdk.charsets
  - jdk.compiler
  - jdk.crypto.cryptoki
  - jdk.crypto.ec
  - jdk.dynalink
  - jdk.editpad
  - jdk.hotspot.agent
  - jdk.httpserver
  - jdk.internal.ed
  - jdk.internal.jvmstat
  - jdk.internal.le
  - jdk.internal.opt
  - jdk.internal.vm.ci
  - jdk.internal.vm.compiler
  - jdk.internal.vm.compiler.management
  - jdk.jartool
  - jdk.javadoc
  - jdk.jcmd
  - jdk.jconsole
  - jdk.jdeps
  - jdk.jdi
  - jdk.jdwp.agent
  - jdk.jfr
  - jdk.jlink
  - jdk.jshell
  - jdk.jsobject
  - jdk.jstatd
  - jdk.localedata
  - jdk.management
  - jdk.management.agent
  - jdk.management.jfr
  - jdk.naming.dns
  - jdk.naming.ldap
  - jdk.naming.rmi
  - jdk.net
  - jdk.pack
  - jdk.rmic
  - jdk.scripting.nashorn
  - jdk.scripting.nashorn.shell
  - jdk.sctp
  - jdk.security.auth
  - jdk.security.jgss
  - jdk.unsupported
  - jdk.unsupported.desktop
  - jdk.xml.dom
  - jdk.zipfs

parts:
  dependencies:
    plugin: nil
    stage-packages:
      - base-passwd_data
      - base-files_base
      - base-files_chisel
      - libc6_libs
      - libgcc-s1_libs
      - libstdc++6_libs
      - zlib1g_libs
      - libpcsclite1_libs
      - libnss3_libs

  runtime:
    plugin: nil
    build-packages:
      - openjdk-11-jdk-headless
    override-build: |
      JAVA_HOME=usr/lib/jvm/java-11-openjdk-${CRAFT_ARCH_BUILD_FOR}
      rm -rf ${CRAFT_PART_INSTALL}/${JAVA_HOME}
      jlink --add-modules \
         java.base,java.instrument,\
      java.logging,java.management,java.management.rmi,\
      java.naming,java.net.http,java.prefs,java.rmi,java.scripting,java.se,java.security.jgss,\
      java.security.sasl,java.smartcardio,java.sql,java.sql.rowset,java.transaction.xa,\
      java.xml,java.xml.crypto,jdk.aot,jdk.attach,jdk.charsets,jdk.compiler,\
      jdk.crypto.cryptoki,jdk.crypto.ec,jdk.dynalink,jdk.editpad,\
      jdk.hotspot.agent,jdk.httpserver,jdk.internal.ed,\
      jdk.internal.jvmstat,jdk.internal.le,jdk.internal.opt,\
      jdk.internal.vm.ci,jdk.internal.vm.compiler,jdk.internal.vm.compiler.management,\
      jdk.jartool,jdk.javadoc,jdk.jcmd,jdk.jconsole,jdk.jdeps,jdk.jdi,jdk.jdwp.agent,\
      jdk.jfr,jdk.jlink,jdk.jshell,jdk.jsobject,jdk.jstatd,jdk.localedata,\
      jdk.management,jdk.management.agent,jdk.management.jfr,jdk.naming.dns,\
      jdk.naming.ldap,jdk.naming.rmi,jdk.net,jdk.pack,jdk.rmic,\
      jdk.scripting.nashorn,jdk.scripting.nashorn.shell,jdk.sctp,\
      jdk.security.auth,jdk.security.jgss,jdk.unsupported,\
      jdk.unsupported.desktop,jdk.xml.dom,jdk.zipfs \
      --no-header-files --no-man-pages -G \
      --output ${CRAFT_PART_INSTALL}/${JAVA_HOME}

      cd ${CRAFT_PART_INSTALL}
      mkdir -p usr/bin
      for tool in `ls ${CRAFT_PART_INSTALL}/${JAVA_HOME}/bin`; do
        ln -s --relative ${JAVA_HOME}/bin/${tool} usr/bin/
      done
